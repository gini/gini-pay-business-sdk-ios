<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Integration  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Integration  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
        <img class="logo-icon" src="img/logo.png"/>
    
        </a>
        
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/gini/gini-pay-business-sdk-ios.git">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">GiniPayBusiness Reference</a>
      <img class="carat" src="img/carat.png" />
      Integration  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Documentation.html">Documentation</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="installation.html">Installation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="integration.html">Integration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="customization-guide.html">Customization guide</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="license.html">License</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Classes.html">Other Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/GiniColor.html">GiniColor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/GiniFont.html">GiniFont</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/GiniPayBusiness.html">GiniPayBusiness</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/GiniPayBusinessConfiguration.html">GiniPayBusinessConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PaymentReviewModel.html">PaymentReviewModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PaymentReviewViewController.html">PaymentReviewViewController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ZoomedImageView.html">ZoomedImageView</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ZoomedImageView/ScaleMode.html">– ScaleMode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ZoomedImageView/Offset.html">– Offset</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Enumerations.html">Other Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/GiniPayBusinessError.html">GiniPayBusinessError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Extensions.html">Other Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Character.html">Character</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/String.html">String</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UIColor.html">UIColor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UITextField.html">UITextField</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UIView.html">UIView</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Functions.html">Other Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other%20Functions.html#/s:15GiniPayBusiness04ginibC6BundleSo8NSBundleCyF">giniPayBusinessBundle()</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Protocols.html">Other Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/GiniPayBusinessDelegate.html">GiniPayBusinessDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ImageScrollViewDelegate.html">ImageScrollViewDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Structures.html">Other Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DataForReview.html">DataForReview</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other%20Structs.html#/s:15GiniPayBusiness27PageCollectionCellViewModelV">PageCollectionCellViewModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PaymentInfo.html">PaymentInfo</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='integration' class='heading'>Integration</h1>

<p>Gini Pay provides an information extraction system for analyzing business invoices and transfers them to the iOS banking app, where the payment process will be completed.</p>

<p>The Gini Pay Business SDK for iOS provides functionality to upload the multipage documents with mobile phones, accurate line item extraction enables the user to to pay the invoice with prefferable payment provider. </p>

<p><strong>Note</strong> For supporting each payment provider you need to specify <code>LSApplicationQueriesSchemes</code> in your <code>Info.plist</code> file. App schemes for specification will be provided by Gini.</p>
<h2 id='upload-the-document' class='heading'>Upload the document</h2>

<p>Document upload can be done in two ways:</p>

<p>using <code>GiniApiLib</code>
using <code>GiniCapture</code></p>
<h2 id='giniapilib-initialization' class='heading'>GiniApiLib initialization</h2>

<p>You should have received Gini Pay API client credentials from us. Please get in touch with us in case you don&rsquo;t have them.</p>

<p>If you want to use a transparent proxy with your own authentication you can specify your own domain and add <code>AlternativeTokenSource</code> protocol implementation:</p>
<pre class="highlight swift"><code> <span class="k">let</span> <span class="nv">apiLib</span> <span class="o">=</span>  <span class="kt">GiniApiLib</span><span class="o">.</span><span class="kt">Builder</span><span class="p">(</span><span class="nv">customApiDomain</span><span class="p">:</span> <span class="s">"api.custom.net"</span><span class="p">,</span>
                                 <span class="nv">alternativeTokenSource</span><span class="p">:</span> <span class="kt">MyAlternativeTokenSource</span><span class="p">)</span>
                                 <span class="o">.</span><span class="nf">build</span><span class="p">()</span>
</code></pre>

<p>The token your provide will be added as a bearer token to all api.custom.net requests.</p>

<p>Optionally if you want to use <em>Certificate pinning</em>, provide metadata for the upload process, you can pass both your public key pinning configuration (see <a href="https://github.com/datatheorem/TrustKit">TrustKit repo</a> for more information)</p>
<pre class="highlight swift"><code>    <span class="k">let</span> <span class="nv">giniApiLib</span> <span class="o">=</span> <span class="kt">GiniApiLib</span>
        <span class="o">.</span><span class="kt">Builder</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span> <span class="kt">Client</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"your-id"</span><span class="p">,</span>
                                <span class="nv">secret</span><span class="p">:</span> <span class="s">"your-secret"</span><span class="p">,</span>
                                <span class="nv">domain</span><span class="p">:</span> <span class="s">"your-domain"</span><span class="p">),</span>
                 <span class="nv">api</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">,</span>
                 <span class="nv">pinningConfig</span><span class="p">:</span> <span class="n">yourPublicPinningConfig</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">build</span><span class="p">()</span>
</code></pre>

<blockquote>
<p>⚠️  <strong>Important</strong></p>

<ul>
<li>The document metadata for the upload process is intended to be used for reporting.</li>
</ul>
</blockquote>
<h2 id='ginipaybusiness-initialization' class='heading'>GiniPayBusiness initialization</h2>

<p>Now that the <code>GiniApiLib</code> has been initialized, you can initialize <code><a href="Classes/GiniPayBusiness.html">GiniPayBusiness</a></code></p>
<pre class="highlight swift"><code> <span class="k">let</span> <span class="nv">businessSDK</span> <span class="o">=</span> <span class="kt">GiniPayBusiness</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">giniApiLib</span><span class="p">)</span>
</code></pre>

<p>and upload your document if you plan to do it with <code><a href="Classes/GiniPayBusiness.html">GiniPayBusiness</a></code>. First you need get document service and create partial document.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">documentService</span><span class="p">:</span> <span class="kt">DefaultDocumentService</span> <span class="o">=</span> <span class="n">businessSDK</span><span class="o">.</span><span class="nf">documentService</span><span class="p">()</span>
<span class="n">documentService</span><span class="o">.</span><span class="nf">createDocument</span><span class="p">(</span><span class="nv">fileName</span><span class="p">:</span><span class="s">"ginipay-partial"</span><span class="p">,</span>
                               <span class="nv">docType</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
                               <span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="nf">partial</span><span class="p">(</span><span class="n">documentData</span><span class="p">),</span>
                               <span class="nv">metadata</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</code></pre>

<p>The method above returns the completion block with partial <code>Document</code> in success case.</p>

<p>After receiving the partial document in completion you can get actual composite document:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">partialDocs</span> <span class="o">=</span> <span class="p">[</span><span class="kt">PartialDocumentInfo</span><span class="p">(</span><span class="nv">document</span><span class="p">:</span> <span class="n">createdDocument</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">document</span><span class="p">)]</span>
 <span class="k">self</span><span class="o">.</span><span class="n">businessSDK</span><span class="o">.</span><span class="n">documentService</span>
            <span class="o">.</span><span class="nf">createDocument</span><span class="p">(</span><span class="nv">fileName</span><span class="p">:</span> <span class="s">"ginipay-composite"</span><span class="p">,</span>
                            <span class="nv">docType</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
                            <span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="nf">composite</span><span class="p">(</span><span class="kt">CompositeDocumentInfo</span><span class="p">(</span><span class="nv">partialDocuments</span><span class="p">:</span> <span class="n">partialDocs</span><span class="p">)),</span>
                            <span class="nv">metadata</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>

</code></pre>
<h2 id='check-preconditions' class='heading'>Check preconditions</h2>

<p>There are three methods in GiniPayBusiness:</p>

<ul>
<li><code>businessSDK.isAnyBankingAppInstalled(appSchemes: [String])</code> without a networking call, returns true when at least the one of the listed among <code>LSApplicationQueriesSchemes</code> in your <code>Info.plist</code> is installed on the device and can support Gini Pay functionality,</li>
<li><code>businessSDK.checkIfAnyPaymentProviderAvailiable()</code> with a networking call, returns a list of availible payment provider or informs that there are no supported banking apps installed,</li>
<li><code>businessSDK.checkIfDocumentIsPayable(docId: String)</code> returns true if Iban was extracted.</li>
</ul>
<h2 id='fetching-data-for-payment-review-screen' class='heading'>Fetching data for payment review screen</h2>

<p>If the preconditions checks are succeeded you can fetch the document and extractions for Payment Review screen:</p>
<pre class="highlight swift"><code><span class="n">businessSDK</span><span class="o">.</span><span class="nf">fetchDataForReview</span><span class="p">(</span><span class="nv">documentId</span><span class="p">:</span> <span class="n">documentId</span><span class="p">,</span>
                              <span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">DataForReview</span><span class="p">,</span> <span class="kt">GiniPayBusinessError</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
</code></pre>

<p>The method above returns the completion block with the struct <code><a href="Structs/DataForReview.html">DataForReview</a></code>, which includes document and extractions.</p>
<h2 id='payment-review-screen-initialization' class='heading'>Payment review screen initialization</h2>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">vc</span> <span class="o">=</span> <span class="kt">PaymentReviewViewController</span><span class="o">.</span><span class="nf">instantiate</span><span class="p">(</span><span class="n">with</span> <span class="nv">giniPayBusiness</span><span class="p">:</span> <span class="n">businessSDK</span><span class="p">,</span>
                                                 <span class="nv">data</span><span class="p">:</span> <span class="n">dataForReview</span><span class="p">)</span>
</code></pre>

<p>The screen can be presented modally, used in a container view or pushed to a navigation view controller. Make sure to add your own navigational elements around the provided views.</p>

<p>To also use the <code><a href="Classes/GiniPayBusinessConfiguration.html">GiniPayBusinessConfiguration</a></code>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">giniConfiguration</span> <span class="o">=</span> <span class="kt">GiniPayBusinessConfiguration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">loadingIndicatorColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">black</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">businessSDK</span><span class="o">.</span><span class="nf">setConfiguration</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre>
<h2 id='gini-pay-deep-link-for-your-app' class='heading'>Gini Pay Deep Link For Your App</h2>

<p>In order for banking apps to be able to return the user to your app after the payment has been resolved you need register a scheme for your app to respond to a deep link scheme known by the Gini Pay API.</p>

<p>You should already have a scheme and host from us. Please contact us in case you don&rsquo;t have them.</p>

<p>The following is an example for the deep link ginipay-business://payment-requester:
<br>
<center><img src="img/Integration guide/SchemeExample.png" width="600"/></center>
</br></p>
<h2 id='testing' class='heading'>Testing</h2>

<p>An example banking app is available in the <a href="https://github.com/gini/gini-pay-bank-sdk-ios">Gini Pay Bank SDK&rsquo;s</a> repository.</p>

<p>In order to test using our example banking app you need to use development client credentials. This will make sure
the Gini Pay Business SDK uses a test payment provider which will open our example banking app. To inject your API credentials into the Bank example app you need to fill in your credentials in <code>Example/Bank/Credentials.plist</code>.</p>
<h4 id='end-to-end-testing' class='heading'>End to end testing</h4>

<p>The app scheme in our banking example app: <code>ginipay-bank://</code>. Please, specify this scheme <code>LSApplicationQueriesSchemes</code> in your app in <code>Info.plist</code> file.</p>

<p>After you&rsquo;ve set the client credentials in the example banking app and installed it on your device you can run your app
and verify that <code>businessSDK.isAnyBankingAppInstalled(appSchemes: [String])</code> returns true and check other preconditions.</p>

<p>After following the integration steps above you&rsquo;ll arrive at the payment review screen.</p>

<p>Check that the extractions and the document preview are shown and then press the <code>Pay</code> button:</p>

<p><br>
<center><img src="img/Customization guide/PaymentReview.PNG" height="500"/></center>
</br></p>

<p>You should be redirected to the example banking app where the final extractions are shown:</p>

<p><br>
<center><img src="img/Integration guide/ReviewScreenBeforeResolvingPayment.PNG" height="500"/></center>
</br></p>

<p>After you press the <code>Pay</code> button the Gini Pay Bank SDK resolves the payment and allows you to return to your app:</p>

<p><br>
<center><img src="img/Integration guide/ReviewScreenAfterResolvingPayment.PNG" height="500"/></center>
</br></p>

<p>For handling incoming url in your app after redirecting back from the banking app you need to implement to handle the incoming url:
The following is an example for the url <code>ginipay-business://payment-requester</code>:</p>
<pre class="highlight swift"><code>    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">app</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span>
                     <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span>
                     <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">OpenURLOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:])</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">host</span> <span class="o">==</span> <span class="s">"payment-requester"</span> <span class="p">{</span>
            <span class="c1">// hadle incoming url from the banking app</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
</code></pre>

<p>With these steps completed you have verified that your app, the Gini Pay API, the Gini Pay Business SDK and the Gini Pay
Bank SDK work together correctly.</p>
<h4 id='testing-in-production' class='heading'>Testing in production</h4>

<p>The steps are the same but instead of the development client credentials you will need to use production client
credentials. This will make sure the Gini Pay Business SDK receives real payment providers which open real banking apps.</p>

<p>You will also need to install a banking app which uses the Gini Pay Bank SDK. Please contact us in case you don&rsquo;t know
which banking app(s) to install.</p>

<p>Lastly make sure that for production you register the scheme we provided you for deep linking and you are not using 
<code>ginipay-business://payment-requester</code>.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2021 <a class="link" href="https://gini.net" target="_blank" rel="external">Gini GmbH</a>. All rights reserved. (Last updated: 2021-11-19)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
